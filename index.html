<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToolHub - 开发者工具集</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.2/spark-md5.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }
        .glass {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }
        .gradient-text {
            background: linear-gradient(135deg, #60a5fa, #a78bfa, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .tool-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(99, 102, 241, 0.15);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .tool-card:hover {
            transform: translateY(-6px) scale(1.02);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
        }
        .tool-card:active {
            transform: translateY(-2px) scale(0.98);
        }
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-backdrop.active { display: flex; }
        .modal-box {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            width: 100%;
            max-width: 800px;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 14px;
        }
        .btn:hover { opacity: 0.9; transform: scale(1.02); }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .btn-danger { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
        .btn-secondary { background: #334155; color: #94a3b8; }
        .input-field {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 12px 16px;
            color: #e2e8f0;
            font-size: 14px;
            width: 100%;
            transition: border-color 0.2s;
        }
        .input-field:focus { outline: none; border-color: #6366f1; }
        .category-btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: #1e293b;
            color: #94a3b8;
        }
        .category-btn:hover { background: #334155; }
        .category-btn.active { 
            background: linear-gradient(135deg, #6366f1, #8b5cf6); 
            color: white; 
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #334155;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    </style>
</head>
<body>
    <nav class="glass fixed top-0 left-0 right-0 z-50">
        <div style="max-width: 1280px; margin: 0 auto; padding: 0 24px;">
            <div style="display: flex; align-items: center; justify-content: space-between; height: 64px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; border-radius: 12px; background: linear-gradient(135deg, #6366f1, #8b5cf6); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-tools" style="color: white; font-size: 18px;"></i>
                    </div>
                    <span style="font-size: 20px; font-weight: 700;" class="gradient-text">ToolHub</span>
                </div>
                <div style="position: relative;">
                    <input type="text" id="searchInput" placeholder="搜索工具..." 
                           style="width: 240px; background: rgba(30,41,59,0.5); border: 1px solid #334155; border-radius: 10px; padding: 8px 16px 8px 36px; color: #e2e8f0; font-size: 14px;">
                    <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #64748b;"></i>
                </div>
            </div>
        </div>
    </nav>

    <main style="padding-top: 100px; padding-bottom: 40px; min-height: 100vh;">
        <div style="max-width: 1280px; margin: 0 auto; padding: 0 24px;">
            <div style="text-align: center; margin-bottom: 60px;">
                <h1 style="font-size: 48px; font-weight: 800; margin-bottom: 16px;">
                    <span class="gradient-text">开发者工具集</span>
                </h1>
                <p style="font-size: 18px; color: #94a3b8; max-width: 600px; margin: 0 auto 24px;">
                    聚合最实用的在线工具，QQ音乐、短视频解析、二维码生成、今日热榜...
                </p>
                <button class="btn btn-primary" style="padding: 14px 32px; font-size: 16px;">
                    <i class="fas fa-rocket" style="margin-right: 8px;"></i>开始使用
                </button>
            </div>

            <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 32px;">
                <button class="category-btn active" data-category="all"><i class="fas fa-th-large" style="margin-right: 6px;"></i>全部</button>
                <button class="category-btn" data-category="media"><i class="fas fa-music" style="margin-right: 6px;"></i>媒体</button>
                <button class="category-btn" data-category="generate"><i class="fas fa-magic" style="margin-right: 6px;"></i>生成</button>
                <button class="category-btn" data-category="info"><i class="fas fa-fire" style="margin-right: 6px;"></i>查询</button>
                <button class="category-btn" data-category="encode"><i class="fas fa-lock" style="margin-right: 6px;"></i>编码</button>
                <button class="category-btn" data-category="format"><i class="fas fa-code" style="margin-right: 6px;"></i>格式</button>
            </div>

            <div id="toolGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;"></div>
        </div>
    </main>

    <div id="modal" class="modal-backdrop" onclick="if(event.target === this) closeModal()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div style="padding: 20px 24px; border-bottom: 1px solid #334155; display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div id="modalIcon" style="width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;"></div>
                    <div>
                        <h3 id="modalTitle" style="font-size: 18px; font-weight: 600; color: white;"></h3>
                        <p id="modalCategory" style="font-size: 13px; color: #64748b;"></p>
                    </div>
                </div>
                <button onclick="closeModal()" style="width: 36px; height: 36px; border-radius: 8px; background: #1e293b; border: none; color: #94a3b8; cursor: pointer; font-size: 18px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modalContent" style="padding: 24px; overflow-y: auto; flex: 1;"></div>
            <div style="padding: 16px 24px; border-top: 1px solid #334155; display: flex; justify-content: flex-end;">
                <button onclick="closeModal()" class="btn btn-secondary">关闭</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://api.sway99.com/api/app/api';
        const API_BASE2 = 'https://api.pearktrue.cn/api';

        const tools = [
            { id: 'qq-music', name: 'QQ音乐搜索', desc: '搜索歌曲，获取播放链接', icon: 'fa-music', color: '#10b981', cat: 'media' },
            { id: 'short-video', name: '短视频解析', desc: '解析抖音/快手主页', icon: 'fa-video', color: '#ec4899', cat: 'media' },
            { id: 'qrcode', name: '二维码生成', desc: '生成多种风格二维码', icon: 'fa-qrcode', color: '#8b5cf6', cat: 'generate' },
            { id: 'daily-hot', name: '今日热榜', desc: '各大平台热榜聚合', icon: 'fa-fire', color: '#f97316', cat: 'info' },
            { id: 'ssl-check', name: 'SSL证书查询', desc: '查询网站证书信息', icon: 'fa-certificate', color: '#06b6d4', cat: 'info' },
            { id: 'text-dub', name: '文本配音', desc: '文本转语音', icon: 'fa-microphone', color: '#a855f7', cat: 'media' },
            { id: 'audio-ocr', name: '音频转文本', desc: '音频识别转文字', icon: 'fa-file-audio', color: '#14b8a6', cat: 'media' },
            { id: 'json-format', name: 'JSON格式化', desc: '格式化压缩验证', icon: 'fa-code', color: '#3b82f6', cat: 'format' },
            { id: 'base64', name: 'Base64编解码', desc: '编码与解码', icon: 'fa-lock', color: '#8b5cf6', cat: 'encode' },
            { id: 'timestamp', name: '时间戳转换', desc: '时间戳日期互转', icon: 'fa-clock', color: '#eab308', cat: 'encode' },
            { id: 'uuid', name: 'UUID生成', desc: '批量生成UUID', icon: 'fa-fingerprint', color: '#a855f7', cat: 'generate' },
            { id: 'hash', name: 'Hash计算', desc: 'MD5/SHA哈希', icon: 'fa-hashtag', color: '#06b6d4', cat: 'encode' }
        ];

        const catNames = { media: '媒体工具', generate: '生成器', info: '信息查询', encode: '编码加密', format: '格式转换' };

        function renderTools(filter = 'all', search = '') {
            const grid = document.getElementById('toolGrid');
            let list = tools;
            if (filter !== 'all') list = list.filter(t => t.cat === filter);
            if (search) list = list.filter(t => t.name.includes(search) || t.desc.includes(search));
            
            grid.innerHTML = list.map(t => `
                <div class="tool-card" style="padding: 24px; border-radius: 16px;" onclick="openTool('${t.id}')">
                    <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 16px;">
                        <div style="width: 48px; height: 48px; border-radius: 12px; background: ${t.color}20; display: flex; align-items: center; justify-content: center;">
                            <i class="fas ${t.icon}" style="font-size: 22px; color: ${t.color};"></i>
                        </div>
                        <span style="padding: 4px 10px; border-radius: 6px; background: #1e293b; color: #64748b; font-size: 12px;">${catNames[t.cat]}</span>
                    </div>
                    <h3 style="font-size: 16px; font-weight: 600; color: white; margin-bottom: 6px;">${t.name}</h3>
                    <p style="font-size: 14px; color: #94a3b8;">${t.desc}</p>
                </div>
            `).join('');
        }

        function openTool(id) {
            const t = tools.find(x => x.id === id);
            if (!t) return;
            
            document.getElementById('modalTitle').textContent = t.name;
            document.getElementById('modalCategory').textContent = catNames[t.cat];
            document.getElementById('modalIcon').innerHTML = `<i class="fas ${t.icon}" style="color: ${t.color};"></i>`;
            document.getElementById('modalIcon').style.background = t.color + '20';
            document.getElementById('modalContent').innerHTML = getToolContent(id);
            document.getElementById('modal').classList.add('active');
            document.body.style.overflow = 'hidden';
            
            if (id === 'daily-hot') loadHotPlatforms();
            if (id === 'text-dub') loadDubVoices();
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function showLoading(id) {
            document.getElementById(id).innerHTML = '<div style="display: flex; justify-content: center; padding: 40px;"><div class="spinner"></div></div>';
        }

        function showError(id, msg) {
            document.getElementById(id).innerHTML = `<div style="text-align: center; padding: 40px; color: #ef4444;"><i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 8px;"></i><p>${msg}</p></div>`;
        }

        function getToolContent(id) {
            const contents = {
                'qq-music': `<div style="display: flex; gap: 12px; margin-bottom: 16px;"><input type="text" id="musicInput" class="input-field" placeholder="输入歌曲名或歌手..." style="flex: 1;"><button onclick="searchMusic()" class="btn btn-success"><i class="fas fa-search" style="margin-right: 6px;"></i>搜索</button></div><div id="musicResults" style="max-height: 400px; overflow-y: auto;"></div>`,
                'short-video': `<div style="margin-bottom: 12px;"><p style="color: #94a3b8; font-size: 13px; margin-bottom: 8px;">请输入抖音/快手用户主页链接，例如：https://v.douyin.com/xxx</p></div><div style="display: flex; gap: 8px; margin-bottom: 16px;"><button onclick="setPlatform('douyin')" id="douyinBtn" class="btn btn-primary" style="flex: 1;">抖音</button><button onclick="setPlatform('kuaishou')" id="kuaishouBtn" class="btn btn-secondary" style="flex: 1;">快手</button></div><div style="display: flex; gap: 12px; margin-bottom: 16px;"><input type="text" id="videoInput" class="input-field" placeholder="输入用户主页链接..." style="flex: 1;"><button onclick="parseVideo()" class="btn btn-primary">解析</button></div><div id="videoResults"></div>`,
                'qrcode': `<div style="margin-bottom: 16px;"><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">二维码内容</label><input type="text" id="qrText" class="input-field" placeholder="输入链接或文本..."></div><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;"><div><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">尺寸</label><select id="qrSize" class="input-field"><option value="150">150x150</option><option value="200" selected>200x200</option><option value="300">300x300</option><option value="400">400x400</option></select></div><div><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">颜色</label><input type="color" id="qrColor" value="#000000" class="input-field" style="height: 42px; padding: 4px;"></div></div><button onclick="genQR()" class="btn btn-primary" style="width: 100%;"><i class="fas fa-qrcode" style="margin-right: 8px;"></i>生成二维码</button><div id="qrResult" style="text-align: center; margin-top: 16px;"></div>`,
                'daily-hot': `<div style="margin-bottom: 16px;"><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">选择平台</label><select id="hotPlatform" class="input-field" onchange="loadHotList()"><option value="">加载中...</option></select></div><div id="hotResults" style="max-height: 400px; overflow-y: auto;"></div>`,
                'ssl-check': `<div style="display: flex; gap: 12px; margin-bottom: 16px;"><input type="text" id="sslDomain" class="input-field" placeholder="输入域名 (如: google.com)" style="flex: 1;"><button onclick="checkSSL()" class="btn btn-primary">查询</button></div><div id="sslResult"></div>`,
                'text-dub': `<div style="margin-bottom: 16px;"><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">输入文本</label><textarea id="dubText" class="input-field" style="height: 100px; resize: none;" placeholder="输入要转换的文本..."></textarea></div><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;"><div><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">音色</label><select id="dubVoice" class="input-field"><option value="">加载中...</option></select></div><div><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">风格</label><select id="dubStyle" class="input-field"><option value="">默认</option></select></div></div><button onclick="genDub()" class="btn btn-primary" style="width: 100%;"><i class="fas fa-microphone" style="margin-right: 8px;"></i>生成语音</button><div id="dubResult" style="margin-top: 16px;"></div>`,
                'audio-ocr': `<div onclick="document.getElementById('audioFile').click()" style="border: 2px dashed #334155; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; margin-bottom: 16px;"><input type="file" id="audioFile" accept="audio/*" style="display: none;" onchange="handleAudio(this)"><i class="fas fa-cloud-upload-alt" style="font-size: 36px; color: #64748b; margin-bottom: 12px;"></i><p style="color: #94a3b8;">点击上传音频文件</p><p style="color: #64748b; font-size: 12px; margin-top: 4px;">支持 MP3、WAV、M4A</p></div><div id="audioName" style="color: #94a3b8; font-size: 14px; margin-bottom: 12px;"></div><button onclick="convertAudio()" class="btn btn-success" style="width: 100%;"><i class="fas fa-file-audio" style="margin-right: 8px;"></i>开始识别</button><div id="audioResult" style="margin-top: 16px;"></div>`,
                'json-format': `<div style="margin-bottom: 16px;"><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">输入 JSON</label><textarea id="jsonInput" class="input-field" style="height: 150px; font-family: monospace; resize: none;" placeholder='{"key": "value"}'></textarea></div><div style="display: flex; gap: 8px; margin-bottom: 16px;"><button onclick="fmtJson()" class="btn btn-primary">格式化</button><button onclick="cmpJson()" class="btn btn-secondary">压缩</button><button onclick="valJson()" class="btn btn-secondary">验证</button></div><div><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">输出结果</label><textarea id="jsonOutput" class="input-field" style="height: 150px; font-family: monospace; resize: none; color: #10b981;" readonly></textarea></div>`,
                'base64': `<div style="display: flex; gap: 8px; margin-bottom: 16px;"><button onclick="setB64Mode('encode')" id="encodeBtn" class="btn btn-primary" style="flex: 1;">编码</button><button onclick="setB64Mode('decode')" id="decodeBtn" class="btn btn-secondary" style="flex: 1;">解码</button></div><div style="margin-bottom: 16px;"><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">输入内容</label><textarea id="b64Input" class="input-field" style="height: 100px; font-family: monospace; resize: none;"></textarea></div><button onclick="procB64()" class="btn btn-primary" style="width: 100%; margin-bottom: 16px;">开始处理</button><div><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">输出结果</label><textarea id="b64Output" class="input-field" style="height: 100px; font-family: monospace; resize: none; color: #10b981;" readonly></textarea></div>`,
                'timestamp': `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;"><div><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">当前时间戳(秒)</label><div style="display: flex; gap: 8px;"><input type="text" id="tsNow" class="input-field" style="font-family: monospace;" readonly><button onclick="navigator.clipboard.writeText(document.getElementById('tsNow').value)" class="btn btn-secondary" style="padding: 8px 12px;"><i class="fas fa-copy"></i></button></div></div><div><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">毫秒时间戳</label><div style="display: flex; gap: 8px;"><input type="text" id="tsNowMs" class="input-field" style="font-family: monospace;" readonly><button onclick="navigator.clipboard.writeText(document.getElementById('tsNowMs').value)" class="btn btn-secondary" style="padding: 8px 12px;"><i class="fas fa-copy"></i></button></div></div></div><div style="margin-bottom: 16px;"><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">时间戳转日期</label><div style="display: flex; gap: 8px;"><input type="number" id="tsToDate" class="input-field" style="font-family: monospace;" placeholder="输入时间戳"><button onclick="ts2Date()" class="btn btn-primary"><i class="fas fa-arrow-right"></i></button></div><input type="text" id="dateResult" class="input-field" style="margin-top: 8px; color: #10b981;" readonly></div><div><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">日期转时间戳</label><div style="display: flex; gap: 8px;"><input type="datetime-local" id="dateToTs" class="input-field"><button onclick="date2Ts()" class="btn btn-primary"><i class="fas fa-arrow-right"></i></button></div><input type="text" id="tsResult" class="input-field" style="margin-top: 8px; color: #10b981;" readonly></div>`,
                'uuid': `<div style="margin-bottom: 16px;"><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">生成数量</label><input type="number" id="uuidCount" class="input-field" value="5" min="1" max="100"></div><button onclick="genUUID()" class="btn btn-primary" style="width: 100%; margin-bottom: 16px;"><i class="fas fa-magic" style="margin-right: 8px;"></i>生成 UUID</button><div><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">生成结果</label><textarea id="uuidOutput" class="input-field" style="height: 200px; font-family: monospace; resize: none; color: #10b981;" readonly></textarea></div>`,
                'hash': `<div style="margin-bottom: 16px;"><label style="display: block; margin-bottom: 8px; font-size: 14px; color: #94a3b8;">输入文本</label><textarea id="hashInput" class="input-field" style="height: 100px; font-family: monospace; resize: none;"></textarea></div><button onclick="genHash()" class="btn btn-primary" style="width: 100%; margin-bottom: 16px;"><i class="fas fa-hashtag" style="margin-right: 8px;"></i>计算哈希</button><div style="display: grid; gap: 12px;"><div><label style="display: block; margin-bottom: 4px; font-size: 13px; color: #94a3b8;">MD5</label><input type="text" id="hashMD5" class="input-field" style="font-family: monospace; color: #10b981;" readonly></div><div><label style="display: block; margin-bottom: 4px; font-size: 13px; color: #94a3b8;">SHA-1</label><input type="text" id="hashSHA1" class="input-field" style="font-family: monospace; color: #10b981;" readonly></div><div><label style="display: block; margin-bottom: 4px; font-size: 13px; color: #94a3b8;">SHA-256</label><input type="text" id="hashSHA256" class="input-field" style="font-family: monospace; color: #10b981;" readonly></div></div>`
            };
            return contents[id] || '<div style="text-align: center; padding: 40px; color: #64748b;">开发中...</div>';
        }

        // QQ音乐
        let musicList = [];
        async function searchMusic() {
            const q = document.getElementById('musicInput').value.trim();
            if (!q) return alert('请输入歌曲名称');
            showLoading('musicResults');
            try {
                const r = await fetch(`${API_BASE}/qq_music?action=search&name=${encodeURIComponent(q)}&limit=10`);
                const d = await r.json();
                if (d.code === 0 && d.data?.list) {
                    musicList = d.data.list;
                    document.getElementById('musicResults').innerHTML = musicList.map((s, i) => `<div onclick="showMusic(${i})" style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#1e293b'" onmouseout="this.style.background='transparent'"><div style="width: 32px; height: 32px; border-radius: 6px; background: #334155; display: flex; align-items: center; justify-content: center; color: #94a3b8; font-size: 14px; font-weight: 600;">${i + 1}</div><div style="flex: 1; min-width: 0;"><div style="color: white; font-weight: 500; margin-bottom: 2px;">${s.name}</div><div style="color: #64748b; font-size: 13px;">${s.singer}</div></div><div style="color: #64748b; font-size: 13px;">${Math.floor(s.interval/60)}:${(s.interval%60).toString().padStart(2,'0')}</div></div>`).join('');
                } else showError('musicResults', d.msg || '搜索失败');
            } catch (e) { showError('musicResults', '网络错误: ' + e.message); }
        }
        function showMusic(i) {
            const s = musicList[i];
            document.getElementById('musicResults').innerHTML = `<div style="padding: 16px; background: #1e293b; border-radius: 12px; margin-bottom: 12px;"><div style="font-size: 18px; font-weight: 600; color: white; margin-bottom: 4px;">${s.name}</div><div style="color: #94a3b8;">${s.singer} - ${s.album}</div></div><div style="display: flex; gap: 8px; margin-bottom: 12px;"><button onclick="getMusicUrl('${s.songmid}')" class="btn btn-success" style="flex: 1;"><i class="fas fa-play" style="margin-right: 6px;"></i>播放链接</button><button onclick="getMusicLyric('${s.songmid}')" class="btn btn-secondary" style="flex: 1;"><i class="fas fa-align-left" style="margin-right: 6px;"></i>歌词</button></div><div id="musicDetail"></div><button onclick="searchMusic()" class="btn btn-secondary" style="width: 100%;"><i class="fas fa-arrow-left" style="margin-right: 6px;"></i>返回</button>`;
        }
        async function getMusicUrl(mid) {
            showLoading('musicDetail');
            try {
                const r = await fetch(`${API_BASE}/qq_music?action=url&songmid=${mid}`);
                const d = await r.json();
                if (d.code === 0 && d.data?.music_url) {
                    document.getElementById('musicDetail').innerHTML = `<div style="padding: 12px; background: #1e293b; border-radius: 8px;"><div style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">播放链接：</div><audio controls src="${d.data.music_url}" style="width: 100%;"></audio></div>`;
                } else showError('musicDetail', d.msg || '获取失败');
            } catch (e) { showError('musicDetail', '网络错误: ' + e.message); }
        }
        async function getMusicLyric(mid) {
            showLoading('musicDetail');
            try {
                const r = await fetch(`${API_BASE}/qq_music?action=lyric&songmid=${mid}`);
                const d = await r.json();
                if (d.code === 0 && d.data) {
                    document.getElementById('musicDetail').innerHTML = `<div style="padding: 12px; background: #1e293b; border-radius: 8px; max-height: 200px; overflow-y: auto;"><pre style="color: #94a3b8; font-size: 12px; white-space: pre-wrap; margin: 0;">${d.data}</pre></div>`;
                } else showError('musicDetail', d.msg || '获取失败');
            } catch (e) { showError('musicDetail', '网络错误: ' + e.message); }
        }

        // 短视频
        let platform = 'douyin';
        function setPlatform(p) {
            platform = p;
            document.getElementById('douyinBtn').className = p === 'douyin' ? 'btn btn-primary' : 'btn btn-secondary';
            document.getElementById('kuaishouBtn').className = p === 'kuaishou' ? 'btn btn-primary' : 'btn btn-secondary';
        }
        async function parseVideo() {
            const url = document.getElementById('videoInput').value.trim();
            if (!url) return alert('请输入用户主页链接');
            showLoading('videoResults');
            try {
                const r = await fetch(`${API_BASE}/short_video?platform=${platform}&user_id=${encodeURIComponent(url)}&type=all`);
                const d = await r.json();
                if (d.code === 0 && d.data) {
                    let html = '';
                    if (d.data.user) {
                        html += `<div style="display: flex; align-items: center; gap: 12px; padding: 16px; background: #1e293b; border-radius: 12px; margin-bottom: 12px;"><img src="${d.data.user.avatar}" style="width: 48px; height: 48px; border-radius: 50%;"><div><div style="font-weight: 600; color: white;">${d.data.user.nickname}</div><div style="color: #64748b; font-size: 13px;">${d.data.user.follower_count} 粉丝</div></div></div>`;
                    }
                    if (d.data.videos?.length) {
                        html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">';
                        d.data.videos.forEach(v => {
                            html += `<div style="background: #1e293b; border-radius: 8px; overflow: hidden;"><img src="${v.cover}" style="width: 100%; aspect-ratio: 16/9; object-fit: cover;"><div style="padding: 8px;"><div style="color: #94a3b8; font-size: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${v.title}</div></div></div>`;
                        });
                        html += '</div>';
                    }
                    document.getElementById('videoResults').innerHTML = html || '<div style="text-align: center; padding: 20px; color: #94a3b8;">未获取到数据</div>';
                } else showError('videoResults', d.msg || '解析失败');
            } catch (e) { showError('videoResults', '网络错误: ' + e.message); }
        }

        // 二维码 - 使用公开API
        async function genQR() {
            const text = document.getElementById('qrText').value.trim();
            if (!text) return alert('请输入内容');
            const size = document.getElementById('qrSize').value;
            const color = document.getElementById('qrColor').value.replace('#', '');
            showLoading('qrResult');
            try {
                const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(text)}&color=${color}&bgcolor=ffffff`;
                document.getElementById('qrResult').innerHTML = `<img src="${qrUrl}" style="max-width: 100%; border-radius: 8px;"><br><a href="${qrUrl}" download="qrcode.png" class="btn btn-secondary" style="margin-top: 12px;"><i class="fas fa-download" style="margin-right: 6px;"></i>下载</a>`;
            } catch (e) { 
                document.getElementById('qrResult').innerHTML = '<p style="color: #ef4444;">生成失败: ' + e.message + '</p>'; 
            }
        }

        // 今日热榜
        async function loadHotPlatforms() {
            try {
                const r = await fetch(`${API_BASE2}/dailyhot/`);
                const d = await r.json();
                if (d.code === 200 && d.data?.platforms) {
                    document.getElementById('hotPlatform').innerHTML = '<option value="">选择平台</option>' + d.data.platforms.map(p => `<option value="${p}">${p}</option>`).join('');
                }
            } catch (e) {
                document.getElementById('hotPlatform').innerHTML = '<option value="">加载失败</option>';
            }
        }
        async function loadHotList() {
            const p = document.getElementById('hotPlatform').value;
            if (!p) return;
            showLoading('hotResults');
            try {
                const r = await fetch(`${API_BASE2}/dailyhot/?title=${encodeURIComponent(p)}`);
                const d = await r.json();
                if (d.code === 200 && d.data?.data) {
                    document.getElementById('hotResults').innerHTML = d.data.data.map((item, i) => `<a href="${item.url}" target="_blank" style="display: flex; align-items: center; gap: 12px; padding: 10px; border-radius: 8px; transition: background 0.2s; text-decoration: none;" onmouseover="this.style.background='#1e293b'" onmouseout="this.style.background='transparent'"><div style="width: 24px; height: 24px; border-radius: 4px; background: ${i < 3 ? 'linear-gradient(135deg, #f97316, #ef4444)' : '#334155'}; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 600;">${i + 1}</div><div style="flex: 1; color: #e2e8f0; font-size: 14px;">${item.title}</div>${item.hot ? `<div style="color: #f97316; font-size: 12px;"><i class="fas fa-fire"></i> ${item.hot}</div>` : ''}</a>`).join('');
                } else showError('hotResults', '获取失败');
            } catch (e) { showError('hotResults', '网络错误: ' + e.message); }
        }

        // SSL
        async function checkSSL() {
            const domain = document.getElementById('sslDomain').value.trim();
            if (!domain) return alert('请输入域名');
            showLoading('sslResult');
            try {
                const r = await fetch(`${API_BASE2}/ssl/?domain=${encodeURIComponent(domain)}`);
                const d = await r.json();
                if (d.code === 200 && d.data) {
                    document.getElementById('sslResult').innerHTML = `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 16px; background: #1e293b; border-radius: 12px;"><div><div style="color: #64748b; font-size: 12px;">主域名</div><div style="color: white;">${d.data.maindomain || '-'}</div></div><div><div style="color: #64748b; font-size: 12px;">签发机构</div><div style="color: white;">${d.data.issuerorg || '-'}</div></div><div><div style="color: #64748b; font-size: 12px;">有效期</div><div style="color: white; font-size: 12px;">${d.data.starttime || '-'} 至 ${d.data.endtime || '-'}</div></div><div><div style="color: #64748b; font-size: 12px;">状态</div><div style="color: ${d.data.valid === '证书有效' ? '#10b981' : '#ef4444'};">${d.data.valid || '-'}</div></div></div>`;
                } else showError('sslResult', d.msg || '查询失败');
            } catch (e) { showError('sslResult', '网络错误: ' + e.message); }
        }

        // 配音
        async function loadDubVoices() {
            try {
                const r = await fetch(`${API_BASE2}/freedub`);
                const d = await r.json();
                if (d.code === 200 && d.data?.voicelist) {
                    const voices = d.data.voicelist;
                    const styles = d.data.stylelist || {};
                    let voiceOptions = '';
                    for (const [key, name] of Object.entries(voices)) {
                        voiceOptions += `<option value="${key}">${name}</option>`;
                    }
                    document.getElementById('dubVoice').innerHTML = voiceOptions;
                    
                    let styleOptions = '<option value="">默认</option>';
                    for (const [key, name] of Object.entries(styles)) {
                        styleOptions += `<option value="${key}">${name}</option>`;
                    }
                    document.getElementById('dubStyle').innerHTML = styleOptions;
                }
            } catch (e) {
                document.getElementById('dubVoice').innerHTML = '<option value="">加载失败</option>';
            }
        }
        async function genDub() {
            const text = document.getElementById('dubText').value.trim();
            if (!text) return alert('请输入文本');
            showLoading('dubResult');
            try {
                const voice = document.getElementById('dubVoice').value;
                const style = document.getElementById('dubStyle').value;
                const r = await fetch(`${API_BASE2}/freedub?text=${encodeURIComponent(text)}&role=${voice}&style=${style}`);
                const d = await r.json();
                if (d.code === 200 && d.data?.audio_url) {
                    document.getElementById('dubResult').innerHTML = `<div style="padding: 12px; background: #1e293b; border-radius: 8px;"><div style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">语音已生成：</div><audio controls src="${d.data.audio_url}" style="width: 100%;"></audio></div>`;
                } else showError('dubResult', d.msg || '生成失败');
            } catch (e) { showError('dubResult', '网络错误: ' + e.message); }
        }

        // 音频转文本
        let audioFile = null;
        function handleAudio(input) {
            if (input.files?.[0]) {
                audioFile = input.files[0];
                document.getElementById('audioName').textContent = '已选择: ' + audioFile.name;
            }
        }
        async function convertAudio() {
            if (!audioFile) return alert('请先上传文件');
            showLoading('audioResult');
            try {
                const fd = new FormData();
                fd.append('file', audioFile);
                const r = await fetch(`${API_BASE2}/audiocr/`, { method: 'POST', body: fd });
                const d = await r.json();
                if (d.code === 200 && d.data) {
                    const content = d.data.content || d.data;
                    document.getElementById('audioResult').innerHTML = `<div style="padding: 12px; background: #1e293b; border-radius: 8px;"><div style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">识别结果：</div><div style="color: #e2e8f0;">${content}</div></div>`;
                } else showError('audioResult', d.msg || '识别失败');
            } catch (e) { showError('audioResult', '网络错误: ' + e.message); }
        }

        // JSON
        function fmtJson() { try { document.getElementById('jsonOutput').value = JSON.stringify(JSON.parse(document.getElementById('jsonInput').value), null, 2); } catch (e) { document.getElementById('jsonOutput').value = '错误: ' + e.message; } }
        function cmpJson() { try { document.getElementById('jsonOutput').value = JSON.stringify(JSON.parse(document.getElementById('jsonInput').value)); } catch (e) { document.getElementById('jsonOutput').value = '错误: ' + e.message; } }
        function valJson() { try { JSON.parse(document.getElementById('jsonInput').value); document.getElementById('jsonOutput').value = '✓ JSON 格式正确'; } catch (e) { document.getElementById('jsonOutput').value = '✗ 错误: ' + e.message; } }

        // Base64
        let b64Mode = 'encode';
        function setB64Mode(m) { b64Mode = m; document.getElementById('encodeBtn').className = m === 'encode' ? 'btn btn-primary' : 'btn btn-secondary'; document.getElementById('decodeBtn').className = m === 'decode' ? 'btn btn-primary' : 'btn btn-secondary'; }
        function procB64() { try { document.getElementById('b64Output').value = b64Mode === 'encode' ? btoa(unescape(encodeURIComponent(document.getElementById('b64Input').value))) : decodeURIComponent(escape(atob(document.getElementById('b64Input').value))); } catch (e) { document.getElementById('b64Output').value = '错误: ' + e.message; } }

        // 时间戳
        function updateTs() { const n = Date.now(); document.getElementById('tsNow').value = Math.floor(n / 1000); document.getElementById('tsNowMs').value = n; }
        function ts2Date() { const t = document.getElementById('tsToDate').value; if (!t) return; const d = new Date(parseInt(t) * (t.length === 10 ? 1000 : 1)); document.getElementById('dateResult').value = d.toLocaleString('zh-CN'); }
        function date2Ts() { const d = document.getElementById('dateToTs').value; if (!d) return; const t = new Date(d).getTime(); document.getElementById('tsResult').value = '秒: ' + Math.floor(t / 1000) + ' | 毫秒: ' + t; }

        // UUID
        function genUUID() { const n = Math.min(parseInt(document.getElementById('uuidCount').value) || 5, 100); const arr = []; for (let i = 0; i < n; i++) arr.push(crypto.randomUUID()); document.getElementById('uuidOutput').value = arr.join('\n'); }

        // Hash
        async function genHash() {
            const text = document.getElementById('hashInput').value;
            if (!text) return alert('请输入文本');
            const data = new TextEncoder().encode(text);
            const spark = new SparkMD5.ArrayBuffer();
            spark.append(data);
            document.getElementById('hashMD5').value = spark.end();
            document.getElementById('hashSHA1').value = Array.from(new Uint8Array(await crypto.subtle.digest('SHA-1', data))).map(b => b.toString(16).padStart(2, '0')).join('');
            document.getElementById('hashSHA256').value = Array.from(new Uint8Array(await crypto.subtle.digest('SHA-256', data))).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // 分类按钮
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderTools(btn.dataset.category, document.getElementById('searchInput').value);
            });
        });

        // 搜索
        document.getElementById('searchInput').addEventListener('input', e => {
            const cat = document.querySelector('.category-btn.active')?.dataset.category || 'all';
            renderTools(cat, e.target.value);
        });

        // ESC关闭
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // 初始化
        renderTools();
        setInterval(updateTs, 1000);
    </script>
</body>
</html>